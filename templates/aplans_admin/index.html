{% extends "admin/index.html" %}
{% load i18n %}

{% block sidebar %}
<div id="content-related">
    {% with plans=request.user.get_adminable_plans %}
    {% if plans|length > 1 %}
    <div class="module" id="plan-selector">
        <h2>{% trans 'Select action plan' %}</h2>
        <h3>{% trans 'Action plans' %}</h3>
        <form id="plan-selector-form" method="post" action="{% url 'change-admin-plan' %}">
            {% csrf_token %}
            <div class="actionlist">
                <select name="plan" onchange="this.form.submit()">
                {% for plan in plans %}
                    <option value="{{ plan.id }}"{% if plan.is_active_admin %} selected{% endif %}>{{ plan.name }}</option>
                {% endfor %}
               </select>
            </div>
        </form>
    </div>
    {% endif %}
    {% endwith %}

    <div class="module" id="recent-actions-module">
        <h2>{% trans 'Recent actions' %}</h2>
        <h3>{% trans 'My actions' %}</h3>
            {% load log %}
            {% get_admin_log 10 as admin_log for_user user %}
            {% if not admin_log %}
            <p>{% trans 'None available' %}</p>
            {% else %}
            <ul class="actionlist">
            {% for entry in admin_log %}
            <li class="{% if entry.is_addition %}addlink{% endif %}{% if entry.is_change %}changelink{% endif %}{% if entry.is_deletion %}deletelink{% endif %}">
                {% if entry.is_deletion or not entry.get_admin_url %}
                    {{ entry.object_repr }}
                {% else %}
                    <a href="{{ entry.get_admin_url }}">{{ entry.object_repr }}</a>
                {% endif %}
                <br>
                {% if entry.content_type %}
                    <span class="mini quiet">{% filter capfirst %}{{ entry.content_type }}{% endfilter %}</span>
                {% else %}
                    <span class="mini quiet">{% trans 'Unknown content' %}</span>
                {% endif %}
            </li>
            {% endfor %}
            </ul>
            {% endif %}
    </div>
</div>
{% endblock %}

{% block userlinks %}
{{ block.super }}
/ <form action="{% url 'set_language' %}" method="post" style="display:inline">{% csrf_token %}
    <input name="next" type="hidden" value="{{ redirect_to }}">
    <select name="language" onchange="this.form.submit()">
        {% get_current_language as LANGUAGE_CODE %}
        {% get_available_languages as LANGUAGES %}
        {% get_language_info_list for LANGUAGES as languages %}
        {% for language in languages %}
            <option value="{{ language.code }}"{% if language.code == LANGUAGE_CODE %} selected{% endif %}>
                {{ language.name_local }} ({{ language.code }})
            </option>
        {% endfor %}
    </select>
</form>
{% endblock %}
